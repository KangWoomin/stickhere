{% extends "base.html" %}
{% load static %}
{% block title %}프로필 수정{% endblock %}

{% block content %}
<div class="container">
    <h1>프로필 수정</h1>
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="form-group">
            <label for="nickname">닉네임:</label>
            <input type="text" id="nickname" name="nickname" class="form-control" value="{{ user.nickname }}" required>
        </div>

        <div class="form-group">
            <label for="bio">소개:</label>
            <textarea id="bio" name="text" class="form-control">{{ user_profile.text }}</textarea>
        </div>

        <div class="form-group">
            <label for="location">활동 위치:</label>
            <input type="text" id="location" name="location" class="form-control" value="{{ user_profile.location }}" placeholder="경기도 광주시" required>
        </div>

        <div class="form-group">
            <label for="existing_profile_image">프로필 이미지 선택:</label>
            <select id="existing_profile_image" name="existing_profile_image" class="form-control" onchange="toggleUploadOption()">
                {% if user.img %}
                    <option value="{{ user.img.url }}" selected>현재 이미지</option>
                {% else %}
                    <option value="{% static 'uploads/logo.png'%}" selected>현재 이미지</option>
                {%endif%}
                <option value="{% static 'uploads/coding.png' %}">이미지 1</option>
                <option value="{% static 'uploads/guitar.png' %}">이미지 2</option>
                <option value="{% static 'uploads/head.png' %}">이미지 3</option>
                <option value="upload">이미지 업로드</option>
            </select>
            <div id="upload-section" style="display: none;" class="form-group">
                <label for="new_profile_image">새 프로필 이미지 업로드:</label>
                <input type="file" id="new_profile_image" name="new_profile_image" class="form-control" onchange="previewImage()">
            </div>
        </div>

        <div class="form-group">
            <label for="profile_image_preview">미리보기:</label>
            {% if user.img %}
            <img id="profile_image_preview" src="{{ user.img.url }}" alt="프로필 이미지 미리보기" width="100">
            {% else %}
            <img id="profile_image_preview" src="{% static 'uploads/logo.png' %}" alt="프로필 이미지 미리보기" width="100">
            {%endif%}
        </div>

        <button type="submit" class="btn">저장</button>
        <a href="{% url 'profile_view' user.pk %}" class="btn">취소</a>
    </form>
</div>

<script>
    function toggleUploadOption() {
        const select = document.getElementById('existing_profile_image');
        const uploadSection = document.getElementById('upload-section');
        const preview = document.getElementById('profile_image_preview');
        const selectedValue = select.value;

        if (selectedValue === 'upload') {
            uploadSection.style.display = 'block';  // Show upload section
            preview.src = '';  // Clear preview
        } else {
            uploadSection.style.display = 'none';  // Hide upload section
            preview.src = selectedValue;  // Update preview with selected image URL
        }
    }

    function previewImage() {
        const fileInput = document.getElementById('new_profile_image');
        const preview = document.getElementById('profile_image_preview');

        if (fileInput.files && fileInput.files[0]) {
            const reader = new FileReader();

            reader.onload = function (e) {
                preview.src = e.target.result;
            };

            reader.readAsDataURL(fileInput.files[0]);
        } else {
            preview.src = '';
        }
    }

    // Optional: Initialize the preview with the current selected option
    window.onload = function() {
        const select = document.getElementById('existing_profile_image');
        const preview = document.getElementById('profile_image_preview');
        if (select.value !== 'upload') {
            preview.src = select.value;
        }
    };
</script>
{% endblock %}
